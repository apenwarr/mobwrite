function diff_match_patch(){this.Diff_Timeout=1.0;this.Diff_EditCost=4;this.Diff_DualThreshold=32;this.Match_Balance=0.5;this.Match_Threshold=0.5;this.Match_MinLength=100;this.Match_MaxLength=1000;this.Patch_Margin=4;function d(){var a=0;var b=1;var c=2;while(b!=c){a++;b=c;c=c<<1}return a}this.Match_MaxBits=d()}var DIFF_DELETE=-1;var DIFF_INSERT=1;var DIFF_EQUAL=0;diff_match_patch.prototype.diff_main=function(a,b,c){if(a==b){return[[DIFF_EQUAL,a]]}if(typeof c=='undefined'){c=true}var d=c;var f=this.diff_commonPrefix(a,b);var g=a.substring(0,f);a=a.substring(f);b=b.substring(f);f=this.diff_commonSuffix(a,b);var i=a.substring(a.length-f);a=a.substring(0,a.length-f);b=b.substring(0,b.length-f);var h=this.diff_compute(a,b,d);if(g){h.unshift([DIFF_EQUAL,g])}if(i){h.push([DIFF_EQUAL,i])}this.diff_cleanupMerge(h);return h};diff_match_patch.prototype.diff_compute=function(a,b,c){var d;if(!a){return[[DIFF_INSERT,b]]}if(!b){return[[DIFF_DELETE,a]]}var f=a.length>b.length?a:b;var g=a.length>b.length?b:a;var i=f.indexOf(g);if(i!=-1){d=[[DIFF_INSERT,f.substring(0,i)],[DIFF_EQUAL,g],[DIFF_INSERT,f.substring(i+g.length)]];if(a.length>b.length){d[0][0]=d[2][0]=DIFF_DELETE}return d}f=g=null;var h=this.diff_halfMatch(a,b);if(h){var l=h[0];var j=h[1];var k=h[2];var m=h[3];var n=h[4];var q=this.diff_main(l,k,c);var p=this.diff_main(j,m,c);return q.concat([[DIFF_EQUAL,n]],p)}if(c&&(a.length<100||b.length<100)){c=false}var v;if(c){var r=this.diff_linesToChars(a,b);a=r[0];b=r[1];v=r[2]}d=this.diff_map(a,b);if(!d){d=[[DIFF_DELETE,a],[DIFF_INSERT,b]]}if(c){this.diff_charsToLines(d,v);this.diff_cleanupSemantic(d);d.push([DIFF_EQUAL,'']);var o=0;var s=0;var w=0;var t='';var u='';while(o<d.length){switch(d[o][0]){case DIFF_INSERT:w++;u+=d[o][1];break;case DIFF_DELETE:s++;t+=d[o][1];break;case DIFF_EQUAL:if(s>=1&&w>=1){var r=this.diff_main(t,u,false);d.splice(o-s-w,s+w);o=o-s-w;for(var x=r.length-1;x>=0;x--){d.splice(o,0,r[x])}o=o+r.length}w=0;s=0;t='';u='';break}o++}d.pop()}return d};diff_match_patch.prototype.diff_linesToChars=function(i,h){var l=[];var j={};l[0]='';function k(a){var b='';var c=0;var d=-1;var f=l.length;while(d<a.length-1){d=a.indexOf('\n',c);if(d==-1){d=a.length-1}var g=a.substring(c,d+1);c=d+1;if(j.hasOwnProperty?j.hasOwnProperty(g):(j[g]!==undefined)){b+=String.fromCharCode(j[g])}else{b+=String.fromCharCode(f);j[g]=f;l[f++]=g}}return b}var m=k(i);var n=k(h);return[m,n,l]};diff_match_patch.prototype.diff_charsToLines=function(a,b){for(var c=0;c<a.length;c++){var d=a[c][1];var f=[];for(var g=0;g<d.length;g++){f[g]=b[d.charCodeAt(g)]}a[c][1]=f.join('')}};diff_match_patch.prototype.diff_map=function(a,b){var c=(new Date()).getTime()+this.Diff_Timeout*1000;var d=a.length+b.length-1;var f=this.Diff_DualThreshold*2<d;var g=[];var i=[];var h={};var l={};h[1]=0;l[1]=0;var j,k;var m;var n={};var q=false;var p=!!(n.hasOwnProperty);var v=(a.length+b.length)%2;for(var r=0;r<d;r++){if(this.Diff_Timeout>0&&(new Date()).getTime()>c){return null}g[r]={};for(var o=-r;o<=r;o+=2){if(o==-r||o!=r&&h[o-1]<h[o+1]){j=h[o+1]}else{j=h[o-1]+1}k=j-o;if(f){m=j+','+k;if(v&&(p?n.hasOwnProperty(m):(n[m]!==undefined))){q=true}if(!v){n[m]=r}}while(!q&&j<a.length&&k<b.length&&a.charAt(j)==b.charAt(k)){j++;k++;if(f){m=j+','+k;if(v&&(p?n.hasOwnProperty(m):(n[m]!==undefined))){q=true}if(!v){n[m]=r}}}h[o]=j;g[r][j+','+k]=true;if(j==a.length&&k==b.length){return this.diff_path1(g,a,b)}else if(q){i=i.slice(0,n[m]+1);var s=this.diff_path1(g,a.substring(0,j),b.substring(0,k));return s.concat(this.diff_path2(i,a.substring(j),b.substring(k)))}}if(f){i[r]={};for(var o=-r;o<=r;o+=2){if(o==-r||o!=r&&l[o-1]<l[o+1]){j=l[o+1]}else{j=l[o-1]+1}k=j-o;m=(a.length-j)+','+(b.length-k);if(!v&&(p?n.hasOwnProperty(m):(n[m]!==undefined))){q=true}if(v){n[m]=r}while(!q&&j<a.length&&k<b.length&&a.charAt(a.length-j-1)==b.charAt(b.length-k-1)){j++;k++;m=(a.length-j)+','+(b.length-k);if(!v&&(p?n.hasOwnProperty(m):(n[m]!==undefined))){q=true}if(v){n[m]=r}}l[o]=j;i[r][j+','+k]=true;if(q){g=g.slice(0,n[m]+1);var s=this.diff_path1(g,a.substring(0,a.length-j),b.substring(0,b.length-k));return s.concat(this.diff_path2(i,a.substring(a.length-j),b.substring(b.length-k)))}}}}return null};diff_match_patch.prototype.diff_path1=function(a,b,c){var d=[];var f=b.length;var g=c.length;var i=null;for(var h=a.length-2;h>=0;h--){while(1){if(a[h].hasOwnProperty?a[h].hasOwnProperty((f-1)+','+g):(a[h][(f-1)+','+g]!==undefined)){f--;if(i===DIFF_DELETE){d[0][1]=b.charAt(f)+d[0][1]}else{d.unshift([DIFF_DELETE,b.charAt(f)])}i=DIFF_DELETE;break}else if(a[h].hasOwnProperty?a[h].hasOwnProperty(f+','+(g-1)):(a[h][f+','+(g-1)]!==undefined)){g--;if(i===DIFF_INSERT){d[0][1]=c.charAt(g)+d[0][1]}else{d.unshift([DIFF_INSERT,c.charAt(g)])}i=DIFF_INSERT;break}else{f--;g--;if(i===DIFF_EQUAL){d[0][1]=b.charAt(f)+d[0][1]}else{d.unshift([DIFF_EQUAL,b.charAt(f)])}i=DIFF_EQUAL}}}return d};diff_match_patch.prototype.diff_path2=function(a,b,c){var d=[];var f=0;var g=b.length;var i=c.length;var h=null;for(var l=a.length-2;l>=0;l--){while(1){if(a[l].hasOwnProperty?a[l].hasOwnProperty((g-1)+','+i):(a[l][(g-1)+','+i]!==undefined)){g--;if(h===DIFF_DELETE){d[f-1][1]+=b.charAt(b.length-g-1)}else{d[f++]=[DIFF_DELETE,b.charAt(b.length-g-1)]}h=DIFF_DELETE;break}else if(a[l].hasOwnProperty?a[l].hasOwnProperty(g+','+(i-1)):(a[l][g+','+(i-1)]!==undefined)){i--;if(h===DIFF_INSERT){d[f-1][1]+=c.charAt(c.length-i-1)}else{d[f++]=[DIFF_INSERT,c.charAt(c.length-i-1)]}h=DIFF_INSERT;break}else{g--;i--;if(h===DIFF_EQUAL){d[f-1][1]+=b.charAt(b.length-g-1)}else{d[f++]=[DIFF_EQUAL,b.charAt(b.length-g-1)]}h=DIFF_EQUAL}}}return d};diff_match_patch.prototype.diff_commonPrefix=function(a,b){if(!a||!b||a.charCodeAt(0)!==b.charCodeAt(0)){return 0}var c=0;var d=Math.min(a.length,b.length);var f=d;var g=0;while(c<f){if(a.substring(g,f)==b.substring(g,f)){c=f;g=c}else{d=f}f=Math.floor((d-c)/2+c)}return f};diff_match_patch.prototype.diff_commonSuffix=function(a,b){if(!a||!b||a.charCodeAt(a.length-1)!==b.charCodeAt(b.length-1)){return 0}var c=0;var d=Math.min(a.length,b.length);var f=d;var g=0;while(c<f){if(a.substring(a.length-f,a.length-g)==b.substring(b.length-f,b.length-g)){c=f;g=c}else{d=f}f=Math.floor((d-c)/2+c)}return f};diff_match_patch.prototype.diff_halfMatch=function(n,q){var p=n.length>q.length?n:q;var v=n.length>q.length?q:n;if(p.length<10||v.length<1){return null}var r=this;function o(a,b,c){var d=a.substring(c,c+Math.floor(a.length/4));var f=-1;var g='';var i,h,l,j;while((f=b.indexOf(d,f+1))!=-1){var k=r.diff_commonPrefix(a.substring(c),b.substring(f));var m=r.diff_commonSuffix(a.substring(0,c),b.substring(0,f));if(g.length<m+k){g=b.substring(f-m,f)+b.substring(f,f+k);i=a.substring(0,c-m);h=a.substring(c+k);l=b.substring(0,f-m);j=b.substring(f+k)}}if(g.length>=a.length/2){return[i,h,l,j,g]}else{return null}}var s=o(p,v,Math.ceil(p.length/4));var w=o(p,v,Math.ceil(p.length/2));var t;if(!s&&!w){return null}else if(!w){t=s}else if(!s){t=w}else{t=s[4].length>w[4].length?s:w}var u,x,y,z;if(n.length>q.length){u=t[0];x=t[1];y=t[2];z=t[3]}else{y=t[0];z=t[1];u=t[2];x=t[3]}var A=t[4];return[u,x,y,z,A]};diff_match_patch.prototype.diff_cleanupSemantic=function(a){var b=false;var c=[];var d=0;var f=null;var g=0;var i=0;var h=0;while(g<a.length){if(a[g][0]==DIFF_EQUAL){c[d++]=g;i=h;h=0;f=a[g][1]}else{h+=a[g][1].length;if(f!==null&&(f.length<=i)&&(f.length<=h)){a.splice(c[d-1],0,[DIFF_DELETE,f]);a[c[d-1]+1][0]=DIFF_INSERT;d--;d--;g=d>0?c[d-1]:-1;i=0;h=0;f=null;b=true}}g++}if(b){this.diff_cleanupMerge(a)}this.diff_cleanupSemanticLossless(a)};diff_match_patch.prototype.diff_cleanupSemanticLossless=function(d){var f=/[^a-zA-Z0-9]/;var g=/\s/;var i=/[\r\n]/;var h=/\n\r?\n$/;var l=/^\r?\n\r?\n/;function j(a,b){if(!a||!b){return 5}var c=0;if(a.charAt(a.length-1).match(f)||b.charAt(0).match(f)){c++;if(a.charAt(a.length-1).match(g)||b.charAt(0).match(g)){c++;if(a.charAt(a.length-1).match(i)||b.charAt(0).match(i)){c++;if(a.match(h)||b.match(l)){c++}}}}return c}var k=1;while(k<d.length-1){if(d[k-1][0]==DIFF_EQUAL&&d[k+1][0]==DIFF_EQUAL){var m=d[k-1][1];var n=d[k][1];var q=d[k+1][1];var p=this.diff_commonSuffix(m,n);if(p){var v=n.substring(n.length-p);m=m.substring(0,m.length-p);n=v+n.substring(0,n.length-p);q=v+q}var r=m;var o=n;var s=q;var w=j(m,n)+j(n,q);while(n.charAt(0)===q.charAt(0)){m+=n.charAt(0);n=n.substring(1)+q.charAt(0);q=q.substring(1);var t=j(m,n)+j(n,q);if(t>=w){w=t;r=m;o=n;s=q}}if(d[k-1][1]!=r){if(r){d[k-1][1]=r}else{d.splice(k-1,1);k--}d[k][1]=o;if(s){d[k+1][1]=s}else{d.splice(k+1,1);k--}}}k++}};diff_match_patch.prototype.diff_cleanupEfficiency=function(a){var b=false;var c=[];var d=0;var f='';var g=0;var i=false;var h=false;var l=false;var j=false;while(g<a.length){if(a[g][0]==DIFF_EQUAL){if(a[g][1].length<this.Diff_EditCost&&(l||j)){c[d++]=g;i=l;h=j;f=a[g][1]}else{d=0;f=''}l=j=false}else{if(a[g][0]==DIFF_DELETE){j=true}else{l=true}if(f&&((i&&h&&l&&j)||((f.length<this.Diff_EditCost/2)&&(i+h+l+j)==3))){a.splice(c[d-1],0,[DIFF_DELETE,f]);a[c[d-1]+1][0]=DIFF_INSERT;d--;f='';if(i&&h){l=j=true;d=0}else{d--;g=d>0?c[d-1]:-1;l=j=false}b=true}}g++}if(b){this.diff_cleanupMerge(a)}};diff_match_patch.prototype.diff_cleanupMerge=function(a){a.push([DIFF_EQUAL,'']);var b=0;var c=0;var d=0;var f='';var g='';var i;while(b<a.length){switch(a[b][0]){case DIFF_INSERT:d++;g+=a[b][1];b++;break;case DIFF_DELETE:c++;f+=a[b][1];b++;break;case DIFF_EQUAL:if(c!==0||d!==0){if(c!==0&&d!==0){i=this.diff_commonPrefix(g,f);if(i!==0){if((b-c-d)>0&&a[b-c-d-1][0]==DIFF_EQUAL){a[b-c-d-1][1]+=g.substring(0,i)}else{a.splice(0,0,[DIFF_EQUAL,g.substring(0,i)]);b++}g=g.substring(i);f=f.substring(i)}i=this.diff_commonSuffix(g,f);if(i!==0){a[b][1]=g.substring(g.length-i)+a[b][1];g=g.substring(0,g.length-i);f=f.substring(0,f.length-i)}}if(c===0){a.splice(b-c-d,c+d,[DIFF_INSERT,g])}else if(d===0){a.splice(b-c-d,c+d,[DIFF_DELETE,f])}else{a.splice(b-c-d,c+d,[DIFF_DELETE,f],[DIFF_INSERT,g])}b=b-c-d+(c?1:0)+(d?1:0)+1}else if(b!==0&&a[b-1][0]==DIFF_EQUAL){a[b-1][1]+=a[b][1];a.splice(b,1)}else{b++}d=0;c=0;f='';g='';break}}if(a[a.length-1][1]===''){a.pop()}var h=false;b=1;while(b<a.length-1){if(a[b-1][0]==DIFF_EQUAL&&a[b+1][0]==DIFF_EQUAL){if(a[b][1].substring(a[b][1].length-a[b-1][1].length)==a[b-1][1]){a[b][1]=a[b-1][1]+a[b][1].substring(0,a[b][1].length-a[b-1][1].length);a[b+1][1]=a[b-1][1]+a[b+1][1];a.splice(b-1,1);h=true}else if(a[b][1].substring(0,a[b+1][1].length)==a[b+1][1]){a[b-1][1]+=a[b+1][1];a[b][1]=a[b][1].substring(a[b+1][1].length)+a[b+1][1];a.splice(b+1,1);h=true}}b++}if(h){this.diff_cleanupMerge(a)}};diff_match_patch.prototype.diff_xIndex=function(a,b){var c=0;var d=0;var f=0;var g=0;var i;for(i=0;i<a.length;i++){if(a[i][0]!==DIFF_INSERT){c+=a[i][1].length}if(a[i][0]!==DIFF_DELETE){d+=a[i][1].length}if(c>b){break}f=c;g=d}if(a.length!=i&&a[i][0]===DIFF_DELETE){return g}return g+(b-f)};diff_match_patch.prototype.diff_prettyHtml=function(a){var b=[];var c=0;for(var d=0;d<a.length;d++){var f=a[d][0];var g=a[d][1];var i=g.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\n/g,'&para;<BR>');switch(f){case DIFF_INSERT:b[d]='<INS STYLE="background:#E6FFE6;" TITLE="i='+c+'">'+i+'</INS>';break;case DIFF_DELETE:b[d]='<DEL STYLE="background:#FFE6E6;" TITLE="i='+c+'">'+i+'</DEL>';break;case DIFF_EQUAL:b[d]='<SPAN TITLE="i='+c+'">'+i+'</SPAN>';break}if(f!==DIFF_DELETE){c+=g.length}}return b.join('')};diff_match_patch.prototype.diff_text1=function(a){var b=[];for(var c=0;c<a.length;c++){if(a[c][0]!==DIFF_INSERT){b[c]=a[c][1]}}return b.join('')};diff_match_patch.prototype.diff_text2=function(a){var b=[];for(var c=0;c<a.length;c++){if(a[c][0]!==DIFF_DELETE){b[c]=a[c][1]}}return b.join('')};diff_match_patch.prototype.diff_toDelta=function(a){var b=[];for(var c=0;c<a.length;c++){switch(a[c][0]){case DIFF_INSERT:b[c]='+'+encodeURI(a[c][1]);break;case DIFF_DELETE:b[c]='-'+a[c][1].length;break;case DIFF_EQUAL:b[c]='='+a[c][1].length;break}}return b.join('\t').replace(/\x00/g,'%00').replace(/%20/g,' ')};diff_match_patch.prototype.diff_fromDelta=function(a,b){var c=[];var d=0;var f=0;b=b.replace(/%00/g,'\0');var g=b.split(/\t/g);for(var i=0;i<g.length;i++){var h=g[i].substring(1);switch(g[i].charAt(0)){case'+':try{c[d++]=[DIFF_INSERT,decodeURI(h)]}catch(ex){throw new Error('Illegal escape in diff_fromDelta: '+h);}break;case'-':case'=':var l=parseInt(h,10);if(isNaN(l)||l<0){throw new Error('Invalid number in diff_fromDelta: '+h);}var j=a.substring(f,f+=l);if(g[i].charAt(0)=='='){c[d++]=[DIFF_EQUAL,j]}else{c[d++]=[DIFF_DELETE,j]}break;default:if(g[i]){throw new Error('Invalid diff operation in diff_fromDelta: '+g[i]);}}}if(f!=a.length){throw new Error('Delta length ('+f+') does not equal source text length ('+a.length+').');}return c};diff_match_patch.prototype.match_main=function(a,b,c){c=Math.max(0,Math.min(c,a.length-b.length));if(a==b){return 0}else if(a.length===0){return null}else if(a.substring(c,c+b.length)==b){return c}else{return this.match_bitap(a,b,c)}};diff_match_patch.prototype.match_bitap=function(d,f,g){if(f.length>this.Match_MaxBits){throw new Error('Pattern too long for this browser.');}var i=this.match_alphabet(f);var h=d.length;h=Math.max(h,this.Match_MinLength);h=Math.min(h,this.Match_MaxLength);var l=this;function j(a,b){var c=Math.abs(g-b);return(a/f.length/l.Match_Balance)+(c/h/(1.0-l.Match_Balance))}var k=this.Match_Threshold;var m=d.indexOf(f,g);if(m!=-1){k=Math.min(j(0,m),k)}m=d.lastIndexOf(f,g+f.length);if(m!=-1){k=Math.min(j(0,m),k)}var n=1<<(f.length-1);m=null;var q,p;var v=Math.max(g+g,d.length);var r;for(var o=0;o<f.length;o++){var s=Array(d.length);q=g;p=v;while(q<p){if(j(o,p)<k){q=p}else{v=p}p=Math.floor((v-q)/2+q)}v=p;var w=Math.max(0,g-(p-g)-1);var t=Math.min(d.length-1,f.length+p);if(d.charAt(t)==f.charAt(f.length-1)){s[t]=(1<<(o+1))-1}else{s[t]=(1<<o)-1}for(var u=t-1;u>=w;u--){if(o===0){s[u]=((s[u+1]<<1)|1)&i[d.charAt(u)]}else{s[u]=((s[u+1]<<1)|1)&i[d.charAt(u)]|((r[u+1]<<1)|1)|((r[u]<<1)|1)|r[u+1]}if(s[u]&n){var x=j(o,u);if(x<=k){k=x;m=u;if(u>g){w=Math.max(0,g-(u-g))}else{break}}}}if(j(o+1,g)>k){break}r=s}return m};diff_match_patch.prototype.match_alphabet=function(a){var b={};for(var c=0;c<a.length;c++){b[a.charAt(c)]=0}for(var c=0;c<a.length;c++){b[a.charAt(c)]|=1<<(a.length-c-1)}return b};diff_match_patch.prototype.patch_addContext=function(a,b){var c=b.substring(a.start2,a.start2+a.length1);var d=0;while(b.indexOf(c)!=b.lastIndexOf(c)&&c.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin){d+=this.Patch_Margin;c=b.substring(a.start2-d,a.start2+a.length1+d)}d+=this.Patch_Margin;var f=b.substring(a.start2-d,a.start2);if(f!==''){a.diffs.unshift([DIFF_EQUAL,f])}var g=b.substring(a.start2+a.length1,a.start2+a.length1+d);if(g!==''){a.diffs.push([DIFF_EQUAL,g])}a.start1-=f.length;a.start2-=f.length;a.length1+=f.length+g.length;a.length2+=f.length+g.length};diff_match_patch.prototype.patch_make=function(a,b,c){var d,f;if(typeof a=='string'&&typeof b=='string'&&typeof c=='undefined'){d=a;f=this.diff_main(d,b,true);if(f.length>2){this.diff_cleanupSemantic(f);this.diff_cleanupEfficiency(f)}}else if(typeof a=='object'&&typeof b=='undefined'&&typeof c=='undefined'){f=a;d=this.diff_text1(f)}else if(typeof a=='string'&&typeof b=='object'&&typeof c=='undefined'){d=a;f=b}else if(typeof a=='string'&&typeof b=='string'&&typeof c=='object'){d=a;f=c}else{throw new Error('Unknown call format to patch_make.');}if(f.length===0){return[]}var g=[];var i=new patch_obj();var h=0;var l=0;var j=0;var k=d;var m=d;for(var n=0;n<f.length;n++){var q=f[n][0];var p=f[n][1];if(!h&&q!==DIFF_EQUAL){i.start1=l;i.start2=j}switch(q){case DIFF_INSERT:i.diffs[h++]=f[n];i.length2+=p.length;m=m.substring(0,j)+p+m.substring(j);break;case DIFF_DELETE:i.length1+=p.length;i.diffs[h++]=f[n];m=m.substring(0,j)+m.substring(j+p.length);break;case DIFF_EQUAL:if(p.length<=2*this.Patch_Margin&&h&&f.length!=n+1){i.diffs[h++]=f[n];i.length1+=p.length;i.length2+=p.length}else if(p.length>=2*this.Patch_Margin){if(h){this.patch_addContext(i,k);g.push(i);i=new patch_obj();h=0;k=m}}break}if(q!==DIFF_INSERT){l+=p.length}if(q!==DIFF_DELETE){j+=p.length}}if(h){this.patch_addContext(i,k);g.push(i)}return g};diff_match_patch.prototype.patch_deepCopy=function(a){var b=[];for(var c=0;c<a.length;c++){var d=a[c];var f=new patch_obj();f.diffs=[];for(var g=0;g<d.diffs.length;g++){f.diffs[g]=d.diffs[g].slice()}f.start1=d.start1;f.start2=d.start2;f.length1=d.length1;f.length2=d.length2;b[c]=f}return b};diff_match_patch.prototype.patch_apply=function(a,b){if(a.length==0){return[b,[]]}a=this.patch_deepCopy(a);var c=this.patch_addPadding(a);b=c+b+c;this.patch_splitMax(a);var d=0;var f=[];for(var g=0;g<a.length;g++){var i=a[g].start2+d;var h=this.diff_text1(a[g].diffs);var l=this.match_main(b,h,i);if(l===null){f[g]=false}else{f[g]=true;d=l-i;var j=b.substring(l,l+h.length);if(h==j){b=b.substring(0,l)+this.diff_text2(a[g].diffs)+b.substring(l+h.length)}else{var k=this.diff_main(h,j,false);this.diff_cleanupSemanticLossless(k);var m=0;var n;for(var q=0;q<a[g].diffs.length;q++){var p=a[g].diffs[q];if(p[0]!==DIFF_EQUAL){n=this.diff_xIndex(k,m)}if(p[0]===DIFF_INSERT){b=b.substring(0,l+n)+p[1]+b.substring(l+n)}else if(p[0]===DIFF_DELETE){b=b.substring(0,l+n)+b.substring(l+this.diff_xIndex(k,m+p[1].length))}if(p[0]!==DIFF_DELETE){m+=p[1].length}}}}}b=b.substring(c.length,b.length-c.length);return[b,f]};diff_match_patch.prototype.patch_addPadding=function(a){var b='';for(var c=0;c<this.Patch_Margin;c++){b+=String.fromCharCode(c)}for(var c=0;c<a.length;c++){a[c].start1+=b.length;a[c].start2+=b.length}var d=a[0];var f=d.diffs;if(f.length==0||f[0][0]!=DIFF_EQUAL){f.unshift([DIFF_EQUAL,b]);d.start1-=b.length;d.start2-=b.length;d.length1+=b.length;d.length2+=b.length}else if(b.length>f[0][1].length){var g=b.length-f[0][1].length;f[0][1]=b.substring(f[0][1].length)+f[0][1];d.start1-=g;d.start2-=g;d.length1+=g;d.length2+=g}d=a[a.length-1];f=d.diffs;if(f.length==0||f[f.length-1][0]!=DIFF_EQUAL){f.push([DIFF_EQUAL,b]);d.length1+=b.length;d.length2+=b.length}else if(b.length>f[f.length-1][1].length){var g=b.length-f[f.length-1][1].length;f[f.length-1][1]+=b.substring(0,g);d.length1+=g;d.length2+=g}return b};diff_match_patch.prototype.patch_splitMax=function(a){for(var b=0;b<a.length;b++){if(a[b].length1>this.Match_MaxBits){var c=a[b];a.splice(b--,1);var d=this.Match_MaxBits;var f=c.start1;var g=c.start2;var i='';while(c.diffs.length!==0){var h=new patch_obj();var l=true;h.start1=f-i.length;h.start2=g-i.length;if(i!==''){h.length1=h.length2=i.length;h.diffs.push([DIFF_EQUAL,i])}while(c.diffs.length!==0&&h.length1<d-this.Patch_Margin){var j=c.diffs[0][0];var k=c.diffs[0][1];if(j===DIFF_INSERT){h.length2+=k.length;g+=k.length;h.diffs.push(c.diffs.shift());l=false}else{k=k.substring(0,d-h.length1-this.Patch_Margin);h.length1+=k.length;f+=k.length;if(j===DIFF_EQUAL){h.length2+=k.length;g+=k.length}else{l=false}h.diffs.push([j,k]);if(k==c.diffs[0][1]){c.diffs.shift()}else{c.diffs[0][1]=c.diffs[0][1].substring(k.length)}}}i=this.diff_text2(h.diffs);i=i.substring(i.length-this.Patch_Margin);var m=this.diff_text1(c.diffs).substring(0,this.Patch_Margin);if(m!==''){h.length1+=m.length;h.length2+=m.length;if(h.diffs.length!==0&&h.diffs[h.diffs.length-1][0]===DIFF_EQUAL){h.diffs[h.diffs.length-1][1]+=m}else{h.diffs.push([DIFF_EQUAL,m])}}if(!l){a.splice(++b,0,h)}}}}};diff_match_patch.prototype.patch_toText=function(a){var b=[];for(var c=0;c<a.length;c++){b[c]=a[c]}return b.join('')};diff_match_patch.prototype.patch_fromText=function(a){var b=[];if(!a){return b}a=a.replace(/%00/g,'\0');var c=a.split('\n');var d=0;while(d<c.length){var f=c[d].match(/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/);if(!f){throw new Error('Invalid patch string: '+c[d]);}var g=new patch_obj();b.push(g);g.start1=parseInt(f[1],10);if(f[2]===''){g.start1--;g.length1=1}else if(f[2]=='0'){g.length1=0}else{g.start1--;g.length1=parseInt(f[2],10)}g.start2=parseInt(f[3],10);if(f[4]===''){g.start2--;g.length2=1}else if(f[4]=='0'){g.length2=0}else{g.start2--;g.length2=parseInt(f[4],10)}d++;while(d<c.length){var i=c[d].charAt(0);try{var h=decodeURI(c[d].substring(1))}catch(ex){throw new Error('Illegal escape in patch_fromText: '+h);}if(i=='-'){g.diffs.push([DIFF_DELETE,h])}else if(i=='+'){g.diffs.push([DIFF_INSERT,h])}else if(i==' '){g.diffs.push([DIFF_EQUAL,h])}else if(i=='@'){break}else if(i===''){}else{throw new Error('Invalid patch mode "'+i+'" in: '+h);}d++}}return b};function patch_obj(){this.diffs=[];this.start1=null;this.start2=null;this.length1=0;this.length2=0}patch_obj.prototype.toString=function(){var a,b;if(this.length1===0){a=this.start1+',0'}else if(this.length1==1){a=this.start1+1}else{a=(this.start1+1)+','+this.length1}if(this.length2===0){b=this.start2+',0'}else if(this.length2==1){b=this.start2+1}else{b=(this.start2+1)+','+this.length2}var c=['@@ -'+a+' +'+b+' @@\n'];var d;for(var f=0;f<this.diffs.length;f++){switch(this.diffs[f][0]){case DIFF_INSERT:d='+';break;case DIFF_DELETE:d='-';break;case DIFF_EQUAL:d=' ';break}c[f+1]=d+encodeURI(this.diffs[f][1])+'\n'}return c.join('').replace(/\x00/g,'%00').replace(/%20/g,' ')};var mobwrite={};mobwrite.syncGateway='/scripts/q.py';mobwrite.get_maxchars=200;mobwrite.debug=true;if(!('console'in window)||!('info'in window.console)||!('warn'in window.console)||!('error'in window.console)){mobwrite.debug=false}mobwrite.sniffUserAgent=function(){if(window.opera){mobwrite.UA_opera=true}else{var a=navigator.userAgent.toLowerCase();mobwrite.UA_webkit=a.indexOf('webkit')!=-1;if(!mobwrite.UA_webkit){mobwrite.UA_gecko=a.indexOf('gecko')!=-1;if(!mobwrite.UA_gecko){mobwrite.UA_msie=a.indexOf('msie')!=-1}}}};mobwrite.UA_gecko=false;mobwrite.UA_opera=false;mobwrite.UA_msie=false;mobwrite.UA_webkit=false;mobwrite.sniffUserAgent();mobwrite.syncRunPid_=null;mobwrite.syncKillPid_=null;mobwrite.timeoutInterval=30000;mobwrite.minSyncInterval=1000;mobwrite.maxSyncInterval=10000;mobwrite.syncInterval=2000;mobwrite.syncChange_=false;mobwrite.syncAjaxObj_=null;mobwrite.uniqueId=function(){var a='abcdefghijklmnopqrstuvwxyz';var b=a.charAt(Math.random()*a.length);a+='0123456789-_:.';for(var c=1;c<8;c++){b+=a.charAt(Math.random()*a.length)}if(b.indexOf('--')!=-1){b=mobwrite.uniqueId()}return b};mobwrite.syncUsername=mobwrite.uniqueId();mobwrite.shared={};mobwrite.shareHandlers=[];mobwrite.shareObj=function(a){if(a){this.file=a;this.dmp=new diff_match_patch();this.editStack=[];if(mobwrite.debug){console.info('Creating shareObj: "'+a+'"')}}};mobwrite.shareObj.prototype.shadowText='';mobwrite.shareObj.prototype.clientVersion=0;mobwrite.shareObj.prototype.serverVersion=0;mobwrite.shareObj.prototype.deltaOk=false;mobwrite.shareObj.prototype.mergeChanges=true;mobwrite.shareObj.prototype.getClientText=function(){window.alert('Defined by subclass');return''};mobwrite.shareObj.prototype.setClientText=function(a){window.alert('Defined by subclass')};mobwrite.shareObj.prototype.patchClientText=function(a){var b=this.getClientText();result=this.dmp.patch_apply(a,b);if(b!=result[0]){this.setClientText(result[0])}};mobwrite.shareObj.prototype.onSentDiff=function(a){};mobwrite.shareObj.prototype.fireChange=function(a){if('createEvent'in document){var b=document.createEvent('HTMLEvents');b.initEvent('change',false,false);a.dispatchEvent(b)}else if('fireEvent'in a){a.fireEvent('onchange')}};mobwrite.shareObj.prototype.syncText=function(){var a=this.getClientText();if(this.deltaOk){var b=this.dmp.diff_main(this.shadowText,a,true);if(b.length>2){this.dmp.diff_cleanupSemantic(b);this.dmp.diff_cleanupEfficiency(b)}this.onSentDiff(b);this.shadowText=a;var c=(this.mergeChanges?'d:':'D:')+this.clientVersion+':'+this.dmp.diff_toDelta(b);if(b.length!=1||b[0][0]!=DIFF_EQUAL){mobwrite.syncChange_=true}this.editStack.push([this.clientVersion,c]);this.clientVersion++}else{d=a;if(this.shadowText!=a){this.shadowText=a}this.clientVersion++;var c='r:'+this.clientVersion+':'+encodeURI(d).replace(/%20/g,' ');this.editStack.push([this.clientVersion,c])}var d='F:'+this.serverVersion+':'+encodeURI(this.file)+'\n';for(var f=0;f<this.editStack.length;f++){d+=this.editStack[f][1]+'\n'}return d.replace(/\0/g,'%00')};mobwrite.syncRun1_=function(){mobwrite.syncChange_=false;var a=[];a[0]='u:'+mobwrite.syncUsername+'\n';for(h in mobwrite.shared){a.push(mobwrite.shared[h].syncText())}if(a.length==1){return}var b=(mobwrite.syncGateway.indexOf('://')!=-1);if(mobwrite.debug&&typeof console=='object'){console.info('TO server:\n'+a.join(''))}a.push('\n');a=a.join('');mobwrite.syncKillPid_=window.setTimeout(mobwrite.syncKill_,mobwrite.timeoutInterval);if(b){var c;while(c=document.getElementById('mobwrite_sync')){c.parentNode.removeChild(c)}var d=[];if(a.length>mobwrite.get_maxchars){var f=Math.ceil(a.length/mobwrite.get_maxchars);var g=Math.ceil(a.length/f);var i='b:'+mobwrite.uniqueId()+' '+f+' ';for(var h=1;h<=f;h++){var l=encodeURIComponent(a.substring((h-1)*g,h*g));var j=i+h+' '+l+'\n\n';d.push('p='+encodeURIComponent(j))}}else{d=['p='+encodeURIComponent(a)]}var k=document.getElementsByTagName('head')[0];for(var h=0;h<d.length;h++){c=document.createElement('script');c.type='text/javascript';c.charset='utf-8';c.src=mobwrite.syncGateway+'?'+d[h]+'&c='+mobwrite.uniqueId();c.id='mobwrite_sync';k.appendChild(c)}}else{a='q='+encodeURIComponent(a);mobwrite.syncAjaxObj_=mobwrite.syncLoadAjax_(mobwrite.syncGateway,a,mobwrite.syncCheckAjax_)}};mobwrite.callback=function(a){if(a){mobwrite.syncRun2_(a+'\n')}else{window.clearTimeout(mobwrite.syncKillPid_);mobwrite.syncKillPid_=window.setTimeout(mobwrite.syncKill_,mobwrite.timeoutInterval)}};mobwrite.syncRun2_=function(a){if(mobwrite.debug){console.info('FROM server:\n'+a)}a=a.replace(/%00/g,'\0');if(a.length<2||a.substring(a.length-2)!='\n\n'){a='';if(mobwrite.error){console.info('Truncated data.  Abort.')}}var b=a.split('\n');var c=null;var d=null;for(var f in b){if(!b[f]){break}if(b[f].charAt(1)!=':'){if(mobwrite.debug){console.error('Unparsable line: '+b[f])}continue}var g=b[f].charAt(0);var i=b[f].substring(2);var h;if('FfDdRr'.indexOf(g)!=-1){var l=i.indexOf(':');if(!l){if(mobwrite.debug){console.error('No version number: '+b[f])}continue}h=parseInt(i.substring(0,l),10);if(isNaN(h)){if(mobwrite.debug){console.error('NaN version number: '+b[f])}continue}i=i.substring(l+1)}if(g=='F'||g=='f'){if(mobwrite.shared.hasOwnProperty(i)){c=mobwrite.shared[i];c.deltaOk=true;d=h;for(var f=0;f<c.editStack.length;f++){if(c.editStack[f][0]<=d){c.editStack.splice(f,1);f--}}}else{c=null}}else if(g=='R'||g=='r'){if(c){c.shadowText=decodeURI(i);c.clientVersion=d;c.serverVersion=h;c.editStack=[];if(g=='R'){c.setClientText(c.shadowText)}mobwrite.syncChange_=true}}else if(g=='D'||g=='d'){if(c){if(d!=c.clientVersion){c.deltaOk=false;if(mobwrite.debug){console.error('Client version number mismatch.\nExpected: '+c.clientVersion+' Got: '+d)}}else if(h>c.serverVersion){c.deltaOk=false;if(mobwrite.debug){console.error('Server version in future.\nExpected: '+c.serverVersion+' Got: '+h)}}else if(h<c.serverVersion){if(mobwrite.debug){console.warn('Server version in past.\nExpected: '+c.serverVersion+' Got: '+h)}}else{var j;try{j=c.dmp.diff_fromDelta(c.shadowText,i);c.serverVersion++}catch(ex){j=null;c.deltaOk=false;mobwrite.syncInterval=0;if(mobwrite.debug){console.error('Delta mismatch.\n'+encodeURI(c.shadowText))}}if(j&&(j.length!=1||j[0][0]!=DIFF_EQUAL)){if(g=='D'){c.shadowText=c.dmp.diff_text2(j);c.setClientText(c.shadowText)}else{var k=c.dmp.patch_make(c.shadowText,'',j);var m=c.dmp.patch_apply(k,c.shadowText);c.shadowText=m[0];c.patchClientText(k)}mobwrite.syncChange_=true}}}}}if(mobwrite.syncChange_){mobwrite.syncInterval/=2}else{mobwrite.syncInterval+=1000}mobwrite.syncInterval=Math.max(mobwrite.minSyncInterval,mobwrite.syncInterval);mobwrite.syncInterval=Math.min(mobwrite.maxSyncInterval,mobwrite.syncInterval);window.clearTimeout(mobwrite.syncRunPid_);mobwrite.syncRunPid_=window.setTimeout(mobwrite.syncRun1_,mobwrite.syncInterval);window.clearTimeout(mobwrite.syncKillPid_);mobwrite.syncKillPid_=null};mobwrite.syncKill_=function(){mobwrite.syncKillPid_=null;if(mobwrite.syncAjaxObj_){mobwrite.syncAjaxObj_.abort();mobwrite.syncAjaxObj_=null}if(mobwrite.debug){console.warn('Connection timeout.')}window.clearTimeout(mobwrite.syncRunPid_);mobwrite.syncRunPid_=window.setTimeout(mobwrite.syncRun1_,1)};mobwrite.syncLoadAjax_=function(a,b,c){var d=null;if(window.XMLHttpRequest){try{d=new XMLHttpRequest()}catch(e){d=null}}else if(window.ActiveXObject){try{d=new ActiveXObject('Msxml2.XMLHTTP')}catch(e){try{d=new ActiveXObject('Microsoft.XMLHTTP')}catch(e){d=null}}}if(d){d.onreadystatechange=c;d.open('POST',a,true);d.setRequestHeader('Content-Type','application/x-www-form-urlencoded');d.send(b)}return d};mobwrite.syncCheckAjax_=function(){if(typeof mobwrite=='undefined'||!mobwrite.syncAjaxObj_){return}if(mobwrite.syncAjaxObj_.readyState==4){if(mobwrite.syncAjaxObj_.status==200){var a=mobwrite.syncAjaxObj_.responseText;mobwrite.syncAjaxObj_=null;mobwrite.syncRun2_(a)}else{if(mobwrite.debug){console.warn('Connection error code: '+mobwrite.syncAjaxObj_.status)}mobwrite.syncAjaxObj_=null}}};mobwrite.unload_=function(){if(!mobwrite.syncKillPid_){mobwrite.syncRun1_()}};if(window.addEventListener){window.addEventListener('unload',mobwrite.unload_,false)}else if(window.attachEvent){window.attachEvent('onunload',mobwrite.unload_)}mobwrite.share=function(a){for(var b=0;b<arguments.length;b++){var c=arguments[b];var d=null;for(var f=0;f<mobwrite.shareHandlers.length&&!d;f++){d=mobwrite.shareHandlers[f].call(mobwrite,c)}if(d&&d.file){mobwrite.shared[d.file]=d;if(mobwrite.syncRunPid_==null){mobwrite.syncRunPid_=window.setTimeout(mobwrite.syncRun1_,10)}}}};mobwrite.shareHandlerForm=function(a){if(typeof a=='string'){a=document.getElementById(a)||document.forms[a]}if(a&&'tagName'in a&&a.tagName=='FORM'){for(var b=0,c;c=a.elements[b];b++){mobwrite.share(c)}}return null};mobwrite.shareHandlers.push(mobwrite.shareHandlerForm);mobwrite.shareHiddenObj=function(a){mobwrite.shareObj.apply(this,[a.id]);this.element=a};mobwrite.shareHiddenObj.prototype=new mobwrite.shareObj('');mobwrite.shareHiddenObj.prototype.getClientText=function(){this.mergeChanges=!this.element.value.match(/^\s*-?[\d.]+\s*$/);return this.element.value};mobwrite.shareHiddenObj.prototype.setClientText=function(a){this.element.value=a};mobwrite.shareHiddenObj.shareHandler=function(a){if(typeof a=='string'){a=document.getElementById(a)}if(a&&'type'in a&&a.type=='hidden'){return new mobwrite.shareHiddenObj(a)}return null};mobwrite.shareHandlers.push(mobwrite.shareHiddenObj.shareHandler);mobwrite.shareCheckboxObj=function(a){mobwrite.shareObj.apply(this,[a.id]);this.element=a;this.mergeChanges=false};mobwrite.shareCheckboxObj.prototype=new mobwrite.shareObj('');mobwrite.shareCheckboxObj.prototype.getClientText=function(){return this.element.checked?this.element.value:''};mobwrite.shareCheckboxObj.prototype.setClientText=function(a){var b=this.element.value||'on';this.element.checked=(a==b);this.fireChange(this.element)};mobwrite.shareCheckboxObj.shareHandler=function(a){if(typeof a=='string'){a=document.getElementById(a)}if(a&&'type'in a&&a.type=='checkbox'){return new mobwrite.shareCheckboxObj(a)}return null};mobwrite.shareHandlers.push(mobwrite.shareCheckboxObj.shareHandler);mobwrite.shareSelectObj=function(a){mobwrite.shareObj.apply(this,[a.id]);this.element=a;this.mergeChanges=(a.type=='select-multiple')};mobwrite.shareSelectObj.prototype=new mobwrite.shareObj('');mobwrite.shareSelectObj.prototype.getClientText=function(){var a=[];for(var b=0,c;c=this.element.options[b];b++){if(c.selected){a.push(c.value)}}return a.join('\00')};mobwrite.shareSelectObj.prototype.setClientText=function(a){a='\00'+a+'\00';for(var b=0,c;c=this.element.options[b];b++){c.selected=(a.indexOf('\00'+c.value+'\00')!=-1)}this.fireChange(this.element)};mobwrite.shareSelectObj.shareHandler=function(a){if(typeof a=='string'){a=document.getElementById(a)}if(a&&'type'in a&&(a.type=='select-one'||a.type=='select-multiple')){return new mobwrite.shareSelectObj(a)}return null};mobwrite.shareHandlers.push(mobwrite.shareSelectObj.shareHandler);mobwrite.shareRadioObj=function(a){mobwrite.shareObj.apply(this,[a.id]);this.elements=[a];this.form=a.form;this.name=a.name;this.mergeChanges=false};mobwrite.shareRadioObj.prototype=new mobwrite.shareObj('');mobwrite.shareRadioObj.prototype.getClientText=function(){for(var a=0;a<this.elements.length;a++){if(this.elements[a].checked){return this.elements[a].value}}return''};mobwrite.shareRadioObj.prototype.setClientText=function(a){for(var b=0;b<this.elements.length;b++){this.elements[b].checked=(a==this.elements[b].value);this.fireChange(this.elements[b])}};mobwrite.shareRadioObj.shareHandler=function(a){if(typeof a=='string'){a=document.getElementById(a)}if(a&&'type'in a&&a.type=='radio'){for(var b in mobwrite.shared){if(mobwrite.shared[b].form==a.form&&mobwrite.shared[b].name==a.name){mobwrite.shared[b].elements.push(a);return null}}return new mobwrite.shareRadioObj(a)}return null};mobwrite.shareHandlers.push(mobwrite.shareRadioObj.shareHandler);mobwrite.shareTextareaObj=function(a){mobwrite.shareObj.apply(this,[a.id]);this.element=a;if(a.type=='password'){this.mergeChanges=false}};mobwrite.shareTextareaObj.prototype=new mobwrite.shareObj('');mobwrite.shareTextareaObj.prototype.getClientText=function(){var a=mobwrite.shareTextareaObj.normalizeLinebreaks_(this.element.value);if(this.element.type=='text'){this.mergeChanges=!a.match(/^\s*-?[\d.,]+\s*$/)}return a};mobwrite.shareTextareaObj.prototype.setClientText=function(a){this.element.value=a;this.fireChange(this.element)};mobwrite.shareTextareaObj.prototype.patchClientText=function(a){this.dmp.Match_Balance=0.5;this.dmp.Match_Threshold=0.6;var b=this.getClientText();var c=this.dmp.patch_apply(a,b);if(b!=c[0]){var d=this.captureCursor_();this.setClientText(c[0]);if(d){this.restoreCursor_(d)}}if(mobwrite.debug){for(var f=0;f<c[1].length;f++){if(c[1][f]){console.info('Patch OK.')}else{console.warn('Patch failed: '+a[f])}}}};mobwrite.shareTextareaObj.prototype.captureCursor_=function(){if('activeElement'in this.element&&!this.element.activeElement){return null}var a=this.dmp.Match_MaxBits/2;var b=this.element.value;var c={};if('selectionStart'in this.element){var d=this.element.selectionStart;var f=this.element.selectionEnd;c.startPrefix=b.substring(d-a,d);c.startSuffix=b.substring(d,d+a);c.startPercent=d/b.length;c.collapsed=(d==f);if(!c.collapsed){c.endPrefix=b.substring(f-a,f);c.endSuffix=b.substring(f,f+a);c.endPercent=f/b.length}}else{var g=this.element;while(g.parentNode){g=g.parentNode}if(!g.selection||!g.selection.createRange){return null}var i=g.selection.createRange();if(i.parentElement()!=this.element){return null}var h=g.body.createTextRange();c.collapsed=(i.text=='');h.moveToElementText(this.element);if(!c.collapsed){h.setEndPoint('EndToEnd',i);c.endPrefix=h.text;c.endPercent=c.endPrefix.length/b.length;c.endPrefix=c.endPrefix.substring(c.endPrefix.length-a)}h.setEndPoint('EndToStart',i);c.startPrefix=h.text;c.startPercent=c.startPrefix.length/b.length;c.startPrefix=c.startPrefix.substring(c.startPrefix.length-a);h.moveToElementText(this.element);h.setEndPoint('StartToStart',i);c.startSuffix=h.text.substring(0,a);if(!c.collapsed){h.setEndPoint('StartToEnd',i);c.endSuffix=h.text.substring(0,a)}}if('scrollTop'in this.element){c.scrollTop=this.element.scrollTop/this.element.scrollHeight;c.scrollLeft=this.element.scrollLeft/this.element.scrollWidth}return c};mobwrite.shareTextareaObj.prototype.restoreCursor_=function(a){this.dmp.Match_Balance=0.4;this.dmp.Match_Threshold=0.9;var b=this.dmp.Match_MaxBits/2;var c=this.element.value;var d=a.startPrefix+a.startSuffix;var f=this.dmp.match_main(c,d,Math.round(Math.max(0,Math.min(c.length,a.startPercent*c.length-b))));if(f!==null){var g=c.substring(f,f+d.length);var i=this.dmp.diff_main(d,g,false);f+=this.dmp.diff_xIndex(i,a.startPrefix.length)}var h=null;if(!a.collapsed){d=a.endPrefix+a.endSuffix;h=this.dmp.match_main(c,d,Math.round(Math.max(0,Math.min(c.length,a.endPercent*c.length-b))));if(h!==null){var g=c.substring(h,h+d.length);var i=this.dmp.diff_main(d,g,false);h+=this.dmp.diff_xIndex(i,a.endPrefix.length)}}if(f===null&&h!==null){f=h}else if(f===null&&h===null){f=Math.round(a.startPercent*c.length)}if(h==null){h=f}if('selectionStart'in this.element){this.element.selectionStart=f;this.element.selectionEnd=h}else{var l=this.element;while(l.parentNode){l=l.parentNode}if(!l.selection||!l.selection.createRange){return}var j=this.element.value.substring(0,f);var k=j.replace(/\r\n/g,'\n').length;var m=l.body.createTextRange();m.moveToElementText(this.element);m.collapse(true);m.moveStart('character',k);if(!a.collapsed){j=this.element.value.substring(f,h);var n=j.replace(/\r\n/g,'\n').length;m.moveEnd('character',n)}m.select()}if('scrollTop'in a){this.element.scrollTop=a.scrollTop*this.element.scrollHeight;this.element.scrollLeft=a.scrollLeft*this.element.scrollWidth}};mobwrite.shareTextareaObj.normalizeLinebreaks_=function(a){return a.replace(/\r\n/g,'\n').replace(/\r/g,'\n')};mobwrite.shareTextareaObj.shareHandler=function(a){if(typeof a=='string'){a=document.getElementById(a)}if(a&&'value'in a&&'type'in a&&(a.type=='textarea'||a.type=='text'||a.type=='password')){if(mobwrite.UA_webkit){a.addEventListener('focus',function(){this.activeElement=true},false);a.addEventListener('blur',function(){this.activeElement=false},false);a.activeElement=false}return new mobwrite.shareTextareaObj(a)}return null};mobwrite.shareHandlers.push(mobwrite.shareTextareaObj.shareHandler);